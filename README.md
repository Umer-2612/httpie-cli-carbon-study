# HTTPie CLI — CI/CD Carbon Emissions Study

> **Research fork** of [httpie/cli](https://github.com/httpie/cli) used in the IEEE conference paper:  
> *"Towards Greener Pipelines: Measuring and Optimising Carbon Emissions in CI/CD Workflows"*  
> *(link to paper — placeholder)*

---

## What This Repository Is

This fork instruments the HTTPie CLI CI/CD pipeline with the [Eco-CI Energy Estimation](https://github.com/green-coding-solutions/eco-ci-energy-estimation) GitHub Action to measure the energy consumption of four progressively optimised workflow configurations. The goal is to quantify the carbon impact of common CI/CD optimisation strategies.

---

## Branch Structure

| Branch | Config | Description |
|--------|--------|-------------|
| `main` | — | Original HTTPie CLI code (reference/baseline) |
| `experiment/c1-baseline` | **C1** | 3 original workflow files + Eco-CI instrumentation only |
| `experiment/c2-pip-cache` | **C2** | C1 + `cache: pip` on all `setup-python` steps |
| `experiment/c3-consolidation` | **C3** | All 3 workflows merged into a single `ci-consolidated.yml`, no caching |
| `experiment/c4-combined` | **C4** | C3 + `cache: pip` + path-based trigger filters |

### What each optimisation targets

- **C2 (Pip Cache):** Eliminates repeated package downloads. Expected to reduce dependency installation time and energy.
- **C3 (Consolidation):** Reduces workflow orchestration overhead by sharing setup steps across jobs.
- **C4 (Combined):** Combines C2 + C3 and adds path filters to skip unnecessary runs entirely.

---

## Triggering Runs Manually

All workflow files include a `workflow_dispatch` trigger. To run a workflow manually:

1. Go to your fork on GitHub → **Actions** tab.
2. Select the workflow from the left sidebar.
3. Click **Run workflow**, optionally enter a reason, and click the green button.
4. Repeat across all 4 experiment branches to collect comparable data.

> **Tip:** Run each configuration **5–10 times** to gather enough samples for statistical analysis.

---

## Collecting Results

After your workflow runs complete, download the Eco-CI energy measurement artifacts:

```bash
# Set environment variables
export GITHUB_TOKEN=ghp_yourPersonalAccessToken
export GITHUB_REPO=your-username/httpie-cli-carbon-study

# Install dependencies
pip install requests

# Run the collection script
python scripts/collect_results.py
```

This writes `results/raw_data.csv` with columns:

| Column | Description |
|--------|-------------|
| `run_id` | GitHub Actions run ID |
| `config` | Experiment config (C1–C4) |
| `workflow` | Workflow file name |
| `branch` | Git branch |
| `stage` | CI stage (checkout, dep-install, lint, test, coverage) |
| `energy_joules` | Measured energy for this stage |
| `duration_seconds` | Wall-clock duration for this stage |
| `timestamp` | ISO 8601 timestamp |
| `python_version` | Python version used (where applicable) |

---

## Running the Analysis

```bash
# Install analysis dependencies
pip install jupyter pandas numpy scipy matplotlib

# Launch the notebook
jupyter lab analysis/energy_analysis.ipynb
```

Run all cells. The notebook will:

1. Load `results/raw_data.csv`
2. Compute descriptive statistics (mean, median, std dev) per config and stage
3. Run **Shapiro-Wilk** normality tests on each sample
4. Run **Wilcoxon signed-rank tests** comparing C2, C3, C4 against C1
5. Apply **Bonferroni correction** (α = 0.017 for 3 comparisons)
6. Compute **Cliff's delta** effect sizes
7. Calculate **SCI scores** for Ireland (345 gCO₂eq/kWh) and Norway (25 gCO₂eq/kWh)
8. Generate 3 publication-ready charts → `results/figures/`
9. Print a formatted results summary table

---

## Repository Layout

```
httpie-cli-carbon-study/
├── .github/
│   └── workflows/
│       ├── tests.yml           # C1/C2 — test suite with Eco-CI
│       ├── code-style.yml      # C1/C2 — lint with Eco-CI
│       ├── coverage.yml        # C1/C2 — coverage with Eco-CI
│       └── ci-consolidated.yml # C3/C4 — merged single workflow
├── scripts/
│   └── collect_results.py      # Downloads + parses Eco-CI artifacts
├── analysis/
│   └── energy_analysis.ipynb   # Statistical analysis notebook
├── results/
│   ├── raw_data.csv            # Populated after running collect_results.py
│   └── figures/                # Charts generated by the notebook
└── README.md
```

---

## Eco-CI Measurement Stages

Each workflow measures energy at the following stages using `green-coding-solutions/eco-ci-energy-estimation@v5`:

| Stage label | What it covers |
|-------------|---------------|
| `checkout` | `actions/checkout` step |
| `dependency-installation` | `pip install` / `make install` / `make venv` |
| `lint` | `make codestyle` (code-style workflow only) |
| `test-execution` | `make test` (tests workflow) |
| `coverage` | `make test-cover` (coverage workflow) |
| `dist-test` | `make test-dist` (coverage workflow) |

---

## Citation

If you use this repository or the methodology, please cite:

```
@inproceedings{yourname2026greener,
  title     = {Towards Greener Pipelines: Measuring and Optimising Carbon Emissions in CI/CD Workflows},
  author    = {Your Name},
  booktitle = {IEEE Conference on ...},
  year      = {2026}
}
```

---

## Acknowledgements

- [HTTPie CLI](https://github.com/httpie/cli) — subject project
- [Eco-CI Energy Estimation](https://github.com/green-coding-solutions/eco-ci-energy-estimation) — Green Coding Solutions
- [Software Carbon Intensity (SCI) Standard](https://greensoftware.foundation/projects/software-carbon-intensity) — Green Software Foundation
